\section*{Επίπεδο 3}
Στο τελευταίο αυτό επίπεδο υλοποιείται η απωλεστική (lossy) συμπίεση.
Παραλαμβάνεται σήμα στην συχνότητα που προέκυψε από φιλτραρισμένους
με \emph{TNS} συντελεστές \emph{MDCT}. Δίνονται λοιπόν επίσης και οι συντελεστές
του φίλτρου \emph{ΤΝS}. Για κάθε ένα από τα χρονικά frames 2048 δειγμάτων και
επικάλυψης 50\% της χρονοσειράς που επιλέχθηκε στην πρώτη βαθμίδα, υπολογίζονται
λόγοι σήματος προς μάσκας ανά προκαθορισμένες συχνοτικές μπάντες. Η διαδικασία
εξαγωγής τους βασίζεται σε πίνακες μελέτης της ακουστικής αντίληψης του μέσου
ανθρώπου, το λεγόμενο \emph{ψυχοακουστικό μοντέλο}. Οι λόγοι σήματος προς μάσκας
διαιρούνται από την ισχύ του σήματος στην αντίστοιχη πάντα για να λάβουμε το
ικανοποιητικό ποσοστό ισχύος στη μπάντα αυτή (για να έχουμε χαμηλή απώλεια
ακουστικής αντίληψης), το όριο ακουστότητας. Με βάση τα \emph{όρια ακουστότητας} ανά
μπάντα υπολογίζονται οι βαθμίδες κβάντισης των συχνοτικών συντελεστών σε έναν
ανομοιόμορφο κβαντιστή. Οι βαθμίδες περιγράφονται με συντελεστές, ενώ η μορφή
της σχέσης του κβαντιστή είναι δεδομένη. Έπειτα, λαμβάνονται οι πρώτες διαφορές
επί των συντελεστών για να γίνει η σειρά στάσιμη και συνεπώς πιθανώς κατάλληλη
για κωδικοποίηση \emph{Huffman} με δεδομένο λεξικό από το πρότυπο \emph{AAC},
η οποία και εφαρμόζεται. Ομοίως και για τους ανομοιόμορφα κβαντισμένους
συντελεστές \emph{MDCT}, με την διαφορά ότι επιλέγεται προκαθορισμένο κωδικό λεξικό
Huffman με βάση τη τιμή του μέγιστου κατ' απόλυτη τιμή συντελεστή και το μήκος
της συμπιεσμένης σειράς. Ο τελικώς κωδικοποιημένος ήχος αποθηκεύεται σε ένα
αρχείο το οποίο περιέχει με χρονική σειρά ανά πλαίσιο 2048 δειγμάτων τους
κβαντισμένους συντελεστές \emph{MDCT}, τους συντελεστές βαθμίδων κβάντισης, τον αριθμό
των επιλεγμένων κωδικό-λεξικών \emph{Huffman} του προτύπου που χρησιμοποιήθηκαν, και
τις απαραίτητες για την "αντιστροφή" των προηγούμενων βαθμίδων πληροφοριών.
Το επίπεδο αυτό αποτελείται από τα εξής αρχεία:

\subsection*{psycho.m}
Υλοποιεί την διαδικασία του \emph{ψυχοακουστικού μοντέλου} σε ένα κανάλι για να εξάγει
τους λόγους σήματος προς μάσκα. Λειτουργεί για κάθε κανάλι χωριστά. Για να εξάγουμε
πληροφορία για όλα τα frames στον χρόνο που μετασχηματίζονται στη συχνότητα στο
επίπεδο 1 και θα κωδικοποιηθούν στη συνέχεια, προσθέτουμε $2048 + 1024$ μηδενικά
δείγματα στην αρχή της χρονοσειράς και $2048 - length \text{mod} 1024$ στο τέλος.
Αυτό συμβαίνει γιατί το αποτέλεσμα για κάθε frame εξαρτάται από τα δύο προηγούμενά του.
\begin{center}
  \verb|SMR = psycho(frameT, frameType, frameTprev1, frameTprev2)|
\end{center}

\noindent Επιστρέφει τις ακόλουθες μεταβλητές:
\begin{description}
  \item[\Q{SMR:}] Πίνακας για τον λόγο σήματος προς μάσκα, διάστασης $42 \times 8$
    για frames τύπου \verb|EIGHT_SHORT_SEQUENCE| και $69 \times 1$ αλλιώς.
\end{description}

\noindent Δέχεται τα ακόλουθα ορίσματα:
\begin{description}
  \item[\Q{frameT:}] Το frame $i$ στο πεδίο του χρόνου. Περιέχει δείγματα από 1 κανάλι.
    Πίνακας διαστάσεων $2048 \times 1$.
  \item[\Q{frameType:}] Ο τύπος του frameT, όπως και παραπάνω.
  \item[\Q{frameTprev1:}] Το προηγούμενο frame του frameT στο ίδιο κανάλι στον χρόνο.
  \item[\Q{frameTprev2:}] Το προ-προηγούμενo frame του frameT στο ίδιο κανάλι στον χρόνο.
\end{description}

\subsection*{AACquantizer.m}
Υπολογίζει εσωτερικά το κατώφλι ακουστότητας \emph{T} στο frame ανά μπάντα και
υλοποιεί με αυτή τον κατάλληλο κβαντιστή για ένα κανάλι σε αυτό το frame.
Αφαιρεί την τάση και κάνει στάσιμη με πρώτες διαφορές τους συντελεστές του κβαντιστή
ανά μπάντα.
\begin{center}
  \verb|[S, sfc, G] = AACquantizer(frameF, frameType, SMR)|
\end{center}

\noindent Επιστρέφει τις ακόλουθες μεταβλητές:
\begin{description}
  \item[\Q{S:}] Πίνακας $1024 \times 1$ με τους κβάντισμένους συντελεστές
    \emph{MDCT} του τρέχοντος frame σε ένα κανάλι (για όλους τους τύπους frame).
  \item[\Q{sfc:}] Πίνακας ο οποίος περιέχει συντελεστές που καθορίζουν τις βαθμίδες κβάντισης
    ανά μπάντα. $124 \times 8$ για τύπο \verb|EIGHT_SHORT_SEQUENCE| και $1024 \times 1$
    για όλους τους άλλους.
  \item[\Q{G:}] Πίνακας με την τάση για τη σειρά των συντελεστών του κβαντιστή (sfc).
    Στην υλοποίησή μας αποτελεί την τιμή του συντελεστή της πρώτης μπάντας ανά frame/υπο-frame
    , όπως υποδείχθηκε στην εκφώνηση. $1 \times 8$ για τύπο \verb|EIGHT_SHORT_SEQUENCE|, αλλιώς $1 \times 1$.
\end{description}

\noindent Δέχεται τα ακόλουθα ορίσματα:
\begin{description}
  \item[\Q{frameF:}] Οι συντελεστές (\emph{MDCT}) μετά τη διαδικασία \emph{TNS}
    για το ένα κανάλι. Αποτέλεσμα του δεύτερου επιπέδου.
  \item[\Q{frameType:}] Ο τύπος του frameT, όπως και παραπάνω.
  \item[\Q{SMR:}] Όπως παραπάνω.
\end{description}

\subsection*{iAACquantizer.m}
Υλοποιεί τον αντίστροφο κβαντιστή. Αφού προσθέσει στη σειρά των sfc την τάση ξανά,
ανακτά την μορφή του κβαντιστή και την αντιστρέφει. Τα ορίσματα και οι μεταβλητές
που επιστρέφονται έχουν την ίδια σημασία με παραπάνω.
\begin{center}
  \verb|frameF = iAACquantizer(S, sfc, G, frameType)|
\end{center}

\subsection*{encodeHuff.m}
Κωδικοποίηση εντροπίας (με \emph{Huﬀman}) χρησιμοποιώντας προκαθορισμένα από το πρότυπο
κωδικό-λεξικά. Χρησιμοποιείται για την κωδικοποίηση και των συντελεστών sfc και
των κβαντισμένων συντελεστών \emph{MDCT}.
\begin{center}
  \verb|[huffSec, huffcodebook] = encodeHuff(coeffSec, huffLUT, forceCodebook)|
\end{center}

\noindent Επιστρέφει τις ακόλουθες μεταβλητές:
\begin{description}
  \item[\Q{huffSec:}] Δυαδική ακολουθία (πίνακας γραμμής) που αντιστοιχεί στην
    συμπιεσμένη σειρά.
  \item[\Q{huffcodebook:}] Το \emph{Huﬀman} κωδικό-λεξικό που χρησιμοποιήθηκε.
\end{description}

\noindent Δέχεται τα ακόλουθα ορίσματα:
\begin{description}
  \item[\Q{coeffSec:}] Οι κβαντισμένοι συντελεστές \emph{MDCT} ή συντελεστές βαθμίδων κβάντιστης
    για ένα frame για ένα κανάλι.
  \item[\Q{huffLUT:}] Συλλογή με τα προκαθορισμένα κωδικό-λεξικά του προτύπου.
    Η μεταβλητή αυτή λαμβάνεται κάνοντας χρήση το αρχείο loadLUT.m, το οποίο δίνεται.
  \item[\Q{forcedCodebook:}] Προαιρετικό αριθμητικό όρισμα, κωδικοποιεί με το κωδικό-λεξικό που αντιστοιχεί
    στον αριθμό. Πρακτικά χρησιμοποιείται μόνο για την κωδικοποίηση των sfc, όπου
    χρησιμοποιείται το κωδικό-λεξικό με αριθμό 12, σύμφωνα με το πρότυπο.
\end{description}

\subsection*{decodeHuff.m}
Αποκωδικοποίηση ενός συνόλου κβαντισμένων συντελεστών \emph{MDCT} ή
συντελεστών βαθμίδων κβαστιστή που έχουν κωδικοποιηθεί με \emph{Huﬀman}.
\begin{center}
  \verb|decCoeffs = decodeHuff(huffSec, huffcodebook, huffLUT)|
\end{center}

\noindent Επιστρέφει τις ακόλουθες μεταβλητές:
\begin{description}
  \item[\Q{decCoeffs:}] Οι αποκωδικοποιημένοι συντελεστές.
\end{description}

\noindent Δέχεται τα ακόλουθα ορίσματα:
\begin{description}
  \item[\Q{huffSec:}] Όπως παραπάνω.
  \item[\Q{huffLUT:}] Όπως παραπάνω.
  \item[\Q{huffcodebook:}] Όπως παραπάνω
\end{description}

\subsection*{AACoder3.m}
Υλοποιεί όλη την κωδικοποίηση του τρίτου επιπέδου χρησιμοποιώντας τα δύο προηγούμενα
επίπεδα.
 δομή (struct) διάστασης K × 1 όπου K το πλήθος των frames που έχουν κωδικοποιηθεί. Κάθε
στοιχείο της παραπάνω δομής αποτελείται από τα παρακάτω:
\begin{center}
  \verb|AACSeq3 = AACoder3(fNameIn, fnameAACoded)|
\end{center}

\noindent Επιστρέφει τις ακόλουθες μεταβλητές:
\begin{description}
  \item[\Q{AACSeq3:}] Δομή διαστάσεων $K \times 1$, όπου $K$ το πλήθος των
    κωδικοποιημένων frames. Αποτελεί τη δομή που τελικώς αποθηκεύεται. Κάθε
    στοιχείο της δομής αποτελείται από:
  \begin{description}[leftmargin=0.2cm,rightmargin=0cm]
    \item \Q{AACSeq3(i).frameType:} Όπως παραπάνω.
    \item \Q{AACSeq3(i).winType:} Όπως παραπάνω.
    \item \Q{AACSeq3(i).chl.TNScoeffs:} Όπως παραπάνω.
    \item \Q{AACSeq3(i).chr.TNScoeffs:} Όπως παραπάνω.
    \item \Q{AACSeq3(i).chl.T:} Τα κατώφλια του \emph{ψυχοακουστικού μοντέλου}
      για το αριστερό κανάλι (για λόγους οπτικοποίησης, δε χρειάζονται για την κωδικοποίηση).
    \item \Q{AACSeq3(i).chr.T:} Τα κατώφλια του \emph{ψυχοακουστικού μοντέλου}
      για το δεξί κανάλι (για λόγους οπτικοποίησης, δε χρειάζονται για την κωδικοποίηση).
    \item \Q{AACSeq3(i).chl.G:} Τα κβαντισμένα global gains (1 ή 8) για το αριστερό κανάλι.
    \item \Q{AACSeq3(i).chr.G:} Τα κβαντισμένα global gains (1 ή 8) για το δεξί κανάλι.
    \item \Q{AACSeq3(i).chl.sfc:} Η κωδικοποιημένη (από \emph{Huﬀman}) ακολουθία των sfc για το
      αριστερό κανάλι.
    \item \Q{AACSeq3(i).chr.sfc:} Η κωδικοποιημένη (από \emph{Huﬀman}) ακολουθία των sfc για το δεξί
      κανάλι.
    \item \Q{AACSeq3(i).chl.stream:} Η κωδικοποιημένη (από \emph{Huﬀman}) ακολουθία των
      κβαντισμένων συντελεστών MDCT για το αριστερό κανάλι.
    \item \Q{AACSeq3(i).chr.stream:} Η κωδικοποιημένη (από \emph{Huﬀman}) ακολουθία των
      κβαντισμένων συντελεστών MDCT για το δεξί κανάλι.
    \item \Q{AACSeq3(i).chl.codebook:} Το \emph{Ηuﬀman} κωδικό-λεξικό που
      χρησιμοποιήθηκε για το αριστερό κανάλι.
    \item \Q{AACSeq3(i).chr.codebook:} Το \emph{Ηuﬀman} κωδικό-λεξικό που χρησιμοποιήθηκε για το δεξί
      κανάλι.
  \end{description}
\end{description}

\noindent Δέχεται τα ακόλουθα ορίσματα:
\begin{description}
  \item[\Q{fNameIn:}] Το όνομα του αρχείου \verb|.wav| με το σήμα ήχου προς κωδικοποίηση. Υπόθεση: Το αρχείο περιέχει
    ήχο δικαναλικό με συχνότητα δειγματοληψίας 48 kHz.
  \item[\Q{fnameAACoded:}] Αρχείο \verb|.mat| στο οποίο αποθηκεύεται η δομή AACSeq3.
\end{description}

\subsection*{iAACoder3.m}
Υλοποιεί όλη την αποκωδικοποίηση του τρίτου επιπέδου χρησιμοποιώντας τους
αποκωδικοποιητές των προηγούμενων δύο επιπέδων.
\begin{center}
  \verb|x = iAACoder3(AACSeq3, fNameOut)|
\end{center}

\noindent Επιστρέφει τις ακόλουθες μεταβλητές:
\begin{description}
  \item[\Q{x:}] Οι αποκωδικοποιημένες τιμές του σήματος.
\end{description}

\noindent Δέχεται τα ακόλουθα ορίσματα:
\begin{description}
  \item[\Q{AACSeq2:}] Όπως και παραπάνω.
  \item[\Q{fNameOut:}] Το όνομα του αρχείου \verb|wav| στο οποίο θα εγγραφεί το
    σήμα ήχου μετά την αποκωδικοποίηση. Υποθέτουμε ήχο δικαναλικό και
    δειγματοληψία 48 kHz.
\end{description}

\subsection*{demoAAC3.m}
Επιδεικνύει τη διαδικασία κωδικοποίησης/αποκωδικοποίησης του δεύτερου επιπέδου
εκτυπώνοντας χρήσιμες πληροφορίες με το ακόλουθο signature:
\begin{center}
  \verb|[SNR, bitrate, compression] = demoAAC3(fNameIn, fNameOut, frameAACoded)|
\end{center}

\noindent Επιστρέφει τις ακόλουθες μεταβλητές:
\begin{description}
  \item[\Q{SNR:}] Signal-to-Noise ratio μεταξύ του αποκωδικοποιημένου σήματος και
    της διαφοράς του με το αρχικό σε dB.
  \item[\Q{bitrate:}] bits ανά δευτερόλεπτο.
  \item[\Q{compression:}] Το ποσοστό συμπίεσης, το τελικό μέγεθος πρός το αρχικό.
\end{description}

\noindent Δέχεται τα ακόλουθα ορίσματα:
\begin{description}
  \item[\Q{fNameIn:}] Όπως και παραπάνω.
  \item[\Q{fNameOut:}] Όπως και παραπάνω.
  \item[\Q{fNameAACoded:}] Το όνομα του αρχείου \verb|.mat| στο οποίο
    αποθηκεύεται η δομή AACSeq3.
\end{description}
